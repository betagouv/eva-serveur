# frozen_string_literal: true

div class: 'row' do
  div class: 'structure offset-1 col-4' do
    div class: 'bloc-structure-infos' do
      h2 structure.nom, class: 'titre-entete-page'

      render 'components/panel_introduction',
             text: t('.introduction', lien_aide: admin_aide_path),
             image: 'bienvenue.png'

      div class: 'panel' do
        attributes_table_for structure do
          row :nom
          if structure.instance_of?(StructureLocale)
            row :type_structure do
              traduction_type_structure(structure.type_structure)
            end
            row :code_postal
            row :region
          end
          row :created_at
        end
      end

      structures = if structure.instance_of?(StructureLocale)
                   structure
                 else
                   structures_dependantes
                 end
      render partial: 'admin/structures/statistique',
             locals: { structures: structures }

      if can?(:manage, Compte)
        panel 'Administration' do
          attributes_table_for structure do
            row :id
            row :latitude
            row :longitude
            row :updated_at
            row :structure_referente
            if structure.instance_of?(StructureAdministrative)
              row :structures_dependantes do
                structures_dependantes
              end
            end
          end
        end
      end
    end

    render 'admin/structures/mes_collegues'

    div class: 'bloc-mes-campagnes' do
      h3 'Campagnes'
      table_for campagnes, class: 'index_table' do
        column :libelle
        column :code
        column :nombre_evaluations
        column :actions do |campagne|
          div class: 'table_actions' do
            link_to t('.voir'), admin_campagne_path(campagne), class: 'view_link'
          end
        end
      end
    end

    active_admin_comments_for(resource)
  end
end
