# frozen_string_literal: true

panel t('.titre.restitutions') do
  form method: :get do
    table_for restitutions do
      column :selection do |evenement|
        check_box_tag 'restitutions_selectionnees[]', evenement.id,
                      params[:restitutions_selectionnees]&.include?(evenement.id.to_s)
      end
      column :situation
      column :session_id
      column :date
      column '' do |evenement|
        span link_to t('.rapport'), admin_restitution_path(id: evenement)
        if can? :manage, Compte
          span link_to t('.evenements'),
                       admin_evenements_path(q: { 'session_id_equals' => evenement.session_id })
        end
      end
    end
    div submit_tag 'Filtrer'
  end
end
if restitution_globale.present?
  columns do
    column do
      panel t('.titre.competences_identifiees') do
        ol do
          restitution_globale.competences.each do |niveau_competence|
            li span t(niveau_competence.keys.first,
                      scope: 'admin.restitutions.restitution_competences') +
                    ": #{niveau_competence.values.first}"
          end
        end
      end
    end
    column do
      panel t('.titre.competences_meilleure_restitution') do
        ul do
          restitution_globale.competences_meilleure_restitution.each do |competence|
            li t("admin.restitutions.restitution_competences.#{competence}")
          end
        end
      end
    end
  end

  panel t('.titre.restitution_globale') do
    render partial: 'restitution_globale'
  end
end
